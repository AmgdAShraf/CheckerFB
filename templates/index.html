<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Account Checker</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            width: 90%;
            max-width: 1000px;
        }
        .header-section {
            background: linear-gradient(to right, #007bff, #00c6ff);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        .header-section h1 {
            font-weight: 700;
            margin-bottom: 5px;
        }
        .header-section p {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .count-card {
            border-radius: 10px;
            padding: 20px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out;
        }
        .count-card:hover {
            transform: translateY(-5px);
        }
        .count-card h2 {
            font-size: 2.5em;
            font-weight: 700;
        }
        .count-card p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 0;
        }
        /* Custom gradients for count cards */
        .card-total { background: linear-gradient(to right, #a18cd1, #fbc2eb); }
        .card-live { background: linear-gradient(to right, #84fab0, #8fd3f4); }
        .card-suspended { background: linear-gradient(to right, #ff7e5f, #feb47b); }
        .card-errors { background: linear-gradient(to right, #ff416c, #ff4b2b); }

        .form-section, .results-area {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        textarea, input[type="number"] {
            border-radius: 8px;
            border: 1px solid #ced4da;
            padding: 10px;
        }
        .btn-start {
            background-color: #007bff;
            border: none;
            border-radius: 8px;
            padding: 10px 25px;
            font-size: 1.1em;
            transition: background-color 0.2s ease;
        }
        .btn-start:hover {
            background-color: #0056b3;
        }
        .progress-indicator {
            background-color: #e2e6ea;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .progress-indicator.hidden {
            display: none !important;
        }
        .results-output {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 250px; /* Limit height for scroll */
            overflow-y: auto; /* Enable scroll if content overflows */
            font-size: 0.9em;
            margin-bottom: 10px; /* Space between pre and button */
        }
        .results-box h4 {
            color: #007bff;
            margin-bottom: 15px;
            font-weight: 600;
        }
        .hidden {
            display: none;
        }
        /* Style for copy buttons */
        .copy-button {
            border-radius: 5px;
            padding: 8px 15px;
            font-size: 0.9em;
            margin-top: 10px; /* Space above button */
            float: right; /* Align right */
        }
        .copy-button i {
            margin-right: 5px;
        }
        /* Specific button colors */
        .btn-copy-success { background-color: #28a745; color: white; border-color: #28a745; }
        .btn-copy-warning { background-color: #ffc107; color: #212529; border-color: #ffc107; }
        .btn-copy-danger { background-color: #dc3545; color: white; border-color: #dc3545; }
        .btn-copy-info { background-color: #17a2b8; color: white; border-color: #17a2b8; }

        .btn-copy-success:hover { background-color: #218838; border-color: #1e7e34; }
        .btn-copy-warning:hover { background-color: #e0a800; border-color: #d39e00; }
        .btn-copy-danger:hover { background-color: #c82333; border-color: #bd2130; }
        .btn-copy-info:hover { background-color: #138496; border-color: #117a8b; }

        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); /* Responsive grid */
            gap: 20px; /* Space between results boxes */
        }
        .results-box-wrapper {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column; /* Stack header, pre, and button */
        }
        .results-box-wrapper h4 {
            margin-top: 0;
        }
        .results-box-wrapper .results-output {
            flex-grow: 1; /* Allow pre to take available space */
            margin-bottom: 15px; /* Space before button */
        }
        .results-box-wrapper .copy-button {
            margin-top: auto; /* Push button to the bottom */
        }
    </style>
</head>
<body>
    <div class="main-card">
        <!-- Header Section -->
        <div class="header-section">
            <i class="fas fa-search fa-3x mb-2"></i>
            <h1>Social Media Account Checker</h1>
            <p>Professional Account Verification Tool</p>
        </div>

        <!-- Progress Counts (Counters) -->
        <div class="row text-center mb-4">
            <div class="col-md-3">
                <div class="count-card card-total">
                    <h2 id="totalCheckedCount">0</h2>
                    <p>Total Checked</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="count-card card-live">
                    <h2 id="liveAccountsCount">0</h2>
                    <p>Live Accounts</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="count-card card-suspended">
                    <h2 id="blockedAccountsCount">0</h2>
                    <p>Blocked/Generic</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="count-card card-errors">
                    <h2 id="errorsCount">0</h2>
                    <p>Errors</p>
                </div>
            </div>
        </div>

        <!-- Progress Indicator & Error Message -->
        <div id="progressIndicator" class="progress-indicator mb-4 hidden">
            <i class="fas fa-spinner fa-spin text-primary fs-4"></i>
            <span class="text-secondary fs-5">Processing... <span id="elapsedTime">0.00</span> seconds elapsed.</span>
            <span id="progressBar" class="ms-auto me-2 text-primary">0%</span>
        </div>
        <div id="errorMessage" class="alert alert-danger hidden" role="alert"></div>

        <!-- Input Form Section -->
        <div class="form-section mb-4">
            <div class="mb-3">
                <label for="ids_input" class="form-label fw-bold">List of accounts to check:</label>
                <textarea class="form-control" id="ids_input" rows="8" placeholder="Paste IDs or lines containing IDs here. One entry per line."></textarea>
                <small class="form-text text-muted">Please upload your accounts to the checker in any format. Line by line. IDs, links etc.</small>
                
                <!-- NEW CHECKBOX ADDED HERE -->
                <div class="form-check mt-2">
                    <input class="form-check-input" type="checkbox" id="includeAccountName"> <!-- 'checked' removed to make it OFF by default -->
                    <label class="form-check-label" for="includeAccountName">
                        Include Account Name in Results (e.g., "Name: Original Line")
                    </label>
                    <small class="form-text text-muted d-block">If unchecked, results will show "Status: Original Line".</small>
                </div>
                <!-- END NEW CHECKBOX -->

            </div>
            <div class="row align-items-center mb-3">
                <div class="col-md-6 mb-3 mb-md-0">
                    <label for="num_threads" class="form-label fw-bold">Number of Threads:</label>
                    <input type="number" class="form-control" id="num_threads" value="50" min="1" max="100">
                    <small class="form-text text-muted">More threads can speed up the process, but may use more resources.</small>
                </div>
                <div class="col-md-6 d-flex justify-content-end">
                    <button type="button" class="btn btn-primary btn-lg btn-start" onclick="startChecking()" id="startButton">
                        <i class="fas fa-play-circle me-2"></i> Start Checking
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Output Areas -->
        <div class="results-area">
            <div class="results-container">
                <!-- Live Accounts -->
                <div class="results-box-wrapper">
                    <h4 class="text-success"><i class="fas fa-check-circle me-2"></i>Live Accounts</h4>
                    <pre id="available_profiles" class="results-output"></pre>
                    <button type="button" class="btn copy-button btn-copy-success" onclick="copyResults('available_profiles', this)">
                        <i class="fas fa-copy"></i> Copy Live Accounts
                    </button>
                </div>

                <!-- Blocked/Generic -->
                <div class="results-box-wrapper">
                    <h4 class="text-warning"><i class="fas fa-ban me-2"></i>Blocked/Generic</h4>
                    <pre id="blocked_profiles" class="results-output"></pre>
                    <button type="button" class="btn copy-button btn-copy-warning" onclick="copyResults('blocked_profiles', this)">
                        <i class="fas fa-copy"></i> Copy Blocked Accounts
                    </button>
                </div>

                <!-- Not Found / Errors -->
                <div class="results-box-wrapper">
                    <h4 class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Not Found / Errors</h4>
                    <pre id="not_found_profiles" class="results-output"></pre>
                    <button type="button" class="btn copy-button btn-copy-danger" onclick="copyResults('not_found_profiles', this)">
                        <i class="fas fa-copy"></i> Copy Not Found/Errors
                    </button>
                </div>

                <!-- Successful IDs Only -->
                <div class="results-box-wrapper">
                    <h4 class="text-info"><i class="fas fa-id-card me-2"></i>Successful IDs Only</h4>
                    <pre id="successful_ids" class="results-output"></pre>
                    <button type="button" class="btn copy-button btn-copy-info" onclick="copyResults('successful_ids', this)">
                        <i class="fas fa-copy"></i> Copy Successful IDs
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentSessionId = null;
        let progressInterval = null;

        const elements = {
            totalCheckedCount: document.getElementById('totalCheckedCount'),
            liveAccountsCount: document.getElementById('liveAccountsCount'),
            blockedAccountsCount: document.getElementById('blockedAccountsCount'),
            errorsCount: document.getElementById('errorsCount'),
            idsInput: document.getElementById('ids_input'),
            numThreads: document.getElementById('num_threads'),
            includeAccountName: document.getElementById('includeAccountName'), // ADDED this line
            startButton: document.getElementById('startButton'),
            progressIndicator: document.getElementById('progressIndicator'),
            elapsedTime: document.getElementById('elapsedTime'),
            progressBar: document.getElementById('progressBar'),
            errorMessage: document.getElementById('errorMessage'),
            availableProfiles: document.getElementById('available_profiles'),
            blockedProfiles: document.getElementById('blocked_profiles'),
            notFoundProfiles: document.getElementById('not_found_profiles'),
            successfulIds: document.getElementById('successful_ids')
        };

        function resetUI() {
            elements.totalCheckedCount.textContent = '0';
            elements.liveAccountsCount.textContent = '0';
            elements.blockedAccountsCount.textContent = '0';
            elements.errorsCount.textContent = '0';
            elements.availableProfiles.textContent = '';
            elements.blockedProfiles.textContent = '';
            elements.notFoundProfiles.textContent = '';
            elements.successfulIds.textContent = '';
            elements.errorMessage.classList.add('hidden');
            elements.errorMessage.textContent = '';
            elements.progressIndicator.classList.add('hidden');
            elements.startButton.disabled = false;
            elements.startButton.innerHTML = '<i class="fas fa-play-circle me-2"></i> Start Checking';
            clearInterval(progressInterval);
            currentSessionId = null;
        }

        async function startChecking() {
            resetUI(); // Clear previous state

            const idsInput = elements.idsInput.value;
            const numThreads = elements.numThreads.value;
            const includeAccountName = elements.includeAccountName.checked; // ADDED this line

            if (!idsInput.trim()) {
                elements.errorMessage.textContent = "Please provide IDs to check.";
                elements.errorMessage.classList.remove('hidden');
                return;
            }

            elements.startButton.disabled = true;
            elements.startButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Starting...';
            elements.progressIndicator.classList.remove('hidden');

            try {
                const response = await fetch('/start_check', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ids_input: idsInput,
                        num_threads: numThreads,
                        include_account_name: includeAccountName // ADDED this line
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    currentSessionId = data.session_id;
                    elements.startButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Processing...';
                    
                    const totalInputIds = idsInput.split('\n').filter(line => line.trim() !== '').length;
                    progressInterval = setInterval(fetchProgress, 1000, currentSessionId, totalInputIds);
                } else {
                    elements.errorMessage.textContent = `Error: ${data.error || 'Failed to start checking.'}`;
                    elements.errorMessage.classList.remove('hidden');
                    elements.startButton.disabled = false;
                    elements.startButton.innerHTML = '<i class="fas fa-play-circle me-2"></i> Start Checking';
                    elements.progressIndicator.classList.add('hidden');
                }

            } catch (error) {
                console.error('Fetch error:', error);
                elements.errorMessage.textContent = `Error initiating check. Ensure the server is running and accessible. Details: ${error.message}.`;
                elements.errorMessage.classList.remove('hidden');
                elements.startButton.disabled = false;
                elements.startButton.innerHTML = '<i class="fas fa-play-circle me-2"></i> Start Checking';
                elements.progressIndicator.classList.add('hidden');
            }
        }

        async function fetchProgress(sessionId, totalInputIds) {
            if (!sessionId) return;

            try {
                const response = await fetch(`/get_progress/${sessionId}`);
                const data = await response.json();

                if (response.ok) {
                    elements.totalCheckedCount.textContent = data.checked_count;
                    elements.liveAccountsCount.textContent = data.live_accounts;
                    elements.blockedAccountsCount.textContent = data.blocked_accounts;
                    elements.errorsCount.textContent = data.errors;
                    elements.elapsedTime.textContent = data.elapsed_time.toFixed(2);
                    
                    const progress = totalInputIds > 0 ? (data.checked_count / totalInputIds) * 100 : 0;
                    elements.progressBar.textContent = `${progress.toFixed(0)}%`;

                    if (data.status === 'completed') {
                        clearInterval(progressInterval);
                        elements.startButton.disabled = false;
                        elements.startButton.innerHTML = '<i class="fas fa-play-circle me-2"></i> Start Checking';
                        elements.progressIndicator.classList.add('hidden');
                        
                        if (data.final_results) {
                            elements.availableProfiles.textContent = data.final_results.available.join('\n');
                            elements.blockedProfiles.textContent = data.final_results.blocked.join('\n');
                            elements.notFoundProfiles.textContent = data.final_results.not_found.join('\n');
                            elements.successfulIds.textContent = data.final_results.successful_ids.join('\n');
                        }
                    }
                } else {
                    clearInterval(progressInterval);
                    elements.errorMessage.textContent = `Error fetching progress: ${data.error || 'Unknown error'}. Session may have expired or server restarted.`;
                    elements.errorMessage.classList.remove('hidden');
                    elements.startButton.disabled = false;
                    elements.startButton.innerHTML = '<i class="fas fa-play-circle me-2"></i> Start Checking';
                    elements.progressIndicator.classList.add('hidden');
                }
            } catch (error) {
                console.error('Fetch progress error:', error);
                clearInterval(progressInterval);
                elements.errorMessage.textContent = `Network error fetching progress. Please check server and refresh. Details: ${error.message}.`;
                elements.errorMessage.classList.remove('hidden');
                elements.startButton.disabled = false;
                elements.startButton.innerHTML = '<i class="fas fa-play-circle me-2"></i> Start Checking';
                elements.progressIndicator.classList.add('hidden');
            }
        }

        // --- New function to copy results ---
        function copyResults(elementId, buttonElement) {
            const element = document.getElementById(elementId);
            if (!element || !element.textContent.trim()) {
                alert('No content to copy!');
                return;
            }

            navigator.clipboard.writeText(element.textContent.trim())
                .then(() => {
                    const originalButtonText = buttonElement.innerHTML;
                    buttonElement.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        buttonElement.innerHTML = originalButtonText;
                    }, 2000); // Revert text after 2 seconds
                })
                .catch(err => {
                    console.error('Failed to copy text: ', err);
                    alert('Failed to copy text. Please try again or copy manually.');
                });
        }
    </script>
</body>
</html>
